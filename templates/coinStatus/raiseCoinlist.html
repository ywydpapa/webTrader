<!DOCTYPE html>
<html lang="en">
<head>
    {% include './header.html' %}
    <meta charset="UTF-8">
    <title>Raise Coins</title>
</head>
<body>
<div id="commonTopHeader">
    {% include './comTopHeader.html' %}
</div>

<div id="commonBodyContents">
    {% include './sideMenu.html' %}

    <div id="commonContent">
        <div class="container">
        선택 코인: {{ results["series"][0]["values"][0][4] }}<br>
            <canvas id="hourChart" height="100"></canvas>
        </div>
    </div>
</div>
</body>
<script>
    $(document).ready(function () {
        hourChartSet();
        let urlnew1 = "/coinrate10/{{ results["series"][0]["values"][0][4] }}"
        let urlnew2 = "/coinrate30/{{ results["series"][0]["values"][0][4] }}"
        let urlnew3 = "/coinrate60/{{ results["series"][0]["values"][0][4] }}"
        document.getElementById("m10").setAttribute("href",urlnew1)
        document.getElementById("m30").setAttribute("href",urlnew2)
        document.getElementById("m60").setAttribute("href",urlnew3)
    });

    function hourChartSet() {
        let hourChart = document.getElementById("hourChart").getContext('2d');
        let hour = {{results|tojson}};
        let dateArr = [], datas_1 = [], datas_2 = [], datas_3 = [], datas_4 = [];
        let dataObject1 = {}, dataObject2 = {}, dataObject3 = {}, dataObject4 = {};
        let randomColor1 = "#" + Math.floor(Math.random() * 16777215).toString(16);
        let randomColor2 = "#" + Math.floor(Math.random() * 16777215).toString(16);
        let randomColor3 = "#" + Math.floor(Math.random() * 16777215).toString(16);
        let randomColor4 = "#" + Math.floor(Math.random() * 16777215).toString(16);
        let KR_TIME_DIFF = 9 * 60 * 60 * 1000;
        
        for (let i = 0; i < hour["series"][0]["values"].length; i++) {
            let item = hour["series"][0]["values"][i];
            let value = item[9] / item[1] * 100;
            
            if(parseInt(item[6]) == 1){
                let setDate = new Date(item[7]).getTime();
                setDate = setDate + KR_TIME_DIFF;
                setDate = new Date(setDate).toISOString();
                let date = setDate.substring(5, 10) + " " + setDate.substring(11, 19);
                dateArr.unshift(date);
                datas_1.push(value);
            }else if(parseInt(item[6]) == 2){
                datas_2.push(value);
            }else if(parseInt(item[6]) == 3){
                datas_3.push(value);
            }else if(parseInt(item[6]) == 4){
                datas_4.push(value);
            }
        }
        
        dataObject1.label = 1;
        dataObject1.data = datas_1;
        dataObject1.backgroundColor = randomColor1;
        dataObject2.label = 2;
        dataObject2.data = datas_2;
        dataObject2.backgroundColor = randomColor2;
        dataObject3.label = 3;
        dataObject3.data = datas_3;
        dataObject3.backgroundColor = randomColor3;
        dataObject4.label = 4;
        dataObject4.data = datas_4;
        dataObject4.backgroundColor = randomColor4;

        new Chart(hourChart, {
            type: "bar",
            data: {
                labels: dateArr,
                datasets: [
                    dataObject1,
                    dataObject2,
                    dataObject3,
                    dataObject4
                ],
            },
            options: {
                responsive: true,
                scales: {
                    xAxes: [{
                        stacked: true
                    }],
                    yAxes: [{
                        stacked: true
                    }]
                }
            }
        });
    }
</script>
</html>